## Msgraph Provider

The CloudQuery Microsoft Graph provider pulls configuration out of Azure resources using Microsoft Graph API, normalizes them and stores them in PostgreSQL database.

### Install

 ```shell
 cloudquery init msgraph
 ```

### Authentication

To authenticate cloudquery with your Azure account you can use any of the following options (see full documentation at [AZURE SDK V2](https://github.com/Azure/azure-sdk-for-go#authentication)):

- Client Credentials: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_CLIENT_SECRET`, `AZURE_SUBSCRIPTION_ID`
- Client Certificate: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_CERTIFICATE_PATH`, `AZURE_CERTIFICATE_PASSWORD`, `AZURE_SUBSCRIPTION_ID`
- Resource Owner Password: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_USERNAME`, `AZURE_PASSWORD`, `AZURE_SUBSCRIPTION_ID`

To have access to ad(Active Directory) resources the `app registration/user` should be [added](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal) as Assignment to `Application administrator` role in Active Directory `Roles and administrators` section


### Configuration

The following configuration section can be automatically generated by `cloudquery init azure`:

 ```hcl
 provider "msgraph" {
  resources = [
#    "ad.applications",
#    "ad.groups",
#    "ad.users",
  ]
}
 ```

### Query Examples

#### Find all active directory groups

 ```sql
 SELECT * FROM msgraph_ad_groups;
 ```

#### Find all disabled users 

 ```sql
 SELECT *
 FROM msgraph_ad_users
 WHERE account_enabled IS DISTINCT FROM TRUE;
 ```

#### Find groups that was created last month

 ```sql
 SELECT * from msgraph_ad_groups where created_date_time >= now() - INTERVAL '1 MONTH';
 ```
